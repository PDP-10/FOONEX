;<135-TENEX>SIGNAL.MAC;57    11-Aug-76 16:17:35    EDIT BY CALVIN
; Move NOINT at .SIGNL+4 to .SIGNL+1 since SGNWAT should be called NOINT
;<135-TENEX>SIGNAL.MAC;56     9-FEB-76 10:09:58    EDIT BY PLUMMER
; FIX NOINT STUFF AT SIGNL4
;<135-TENEX>SIGNAL.MAC;55     4-FEB-76 10:13:09    EDIT BY PLUMMER
; FIX LOST FLAGS IN WTFOR0
; CORRECT CHECK ON "DONT WAIT" BIT IN WTFOR0
;<134-TENEX>SIGNAL.MAC;53    28-AUG-75 14:03:56    EDIT BY PLUMMER
; ADD "PEEK" OPTION TO WTFOR
;<134-TENEX>SIGNAL.MAC;51    28-AUG-75 11:59:00    EDIT BY PLUMMER
; ADD GTSIG FLAG WHICH REQUIRES ASSIGNMENT OF A SYSTEM SIGNAL
; FIX ACCESSIBILTY CHECKS IN SIGNL
;<134-TENEX>SIGNAL.MAC;48     2-APR-75 11:27:48    EDIT BY PLUMMER
; SIGNAL WAITS FOR PREVIOUS DATA TO BE READ ONLY IF NEW DATA SUPPLIED
;<134-TENEX>SIGNAL.MAC;47    13-MAR-75 15:56:28    EDIT BY PLUMMER
; FIX RLSIG
;<134-TENEX>SIGNAL.MAC;46    12-MAR-75 22:13:40    EDIT BY PLUMMER
; MAKE WTFOR RETURN SIGNL-ER'S JOB NUMBER IN RH(3) IF DATA RETURNED
; REPAIRS, REARRANGE, ETC
;<134-TENEX>SIGNAL.MAC;40    12-MAR-75 09:59:03    EDIT BY PLUMMER
; INCLUDE CHANGES BY TOMLINSON
;<134-TENEX>SIGNAL.MAC;39    11-MAR-75 18:09:43    EDIT BY PLUMMER

	SEARCH	STENEX,PROLOG
IFDEF SIGIPC,<		;ASSEMBLE ONLY IF CONFIGURATION REQUIRES
	TITLE	SIGNAL
	SUBTTL	WILLIAM W. PLUMMER, 25FEB75


SID=<T1==1>
T2=2
T3=3
T4=4


INTERN	.GTSIG,.RLSIG,.SIGNL,.WTFOR
INTERN	SIGINI,WTFORT,SIGKIL,RMJBRF


EXTERN	MENTR,MRETN,MRETNE,SKMRTN
EXTERN	CAPENB,FKJOB,JOBRT,LSTERR,MINUS1
EXTERN	EDISMS,DISGE,FORKX,JOBNO



DEFINE RETERR(CODE,EXTRA)<
	JRST [	EXTRA
		IFDIF <CODE>,<>,<MOVEI 1,CODE>
		JRST MRETNE]>


LS (SIGLCK,1)			;LOCK ON SIG TABLES
LS (SIGNAL,NSSIGS+NUSIGS)	;SEMAPHORE CELLS: RUN IF AOSLE SKIPS
LS (SIGJOB,NSSIGS+NUSIGS)	;FLAGS,,OWNING JOB  OR -1 IF NOT IN USE
LS (SIGQUE,NSSIGS+NUSIGS)	;SIGNL FORK QUEUE:  IN,,OUT
LS (SIGJB1,NSSIGS+NUSIGS)	;JOBS ALLOWED TO SIGNL THIS SID
LS (SIGJB2,NSSIGS+NUSIGS)	;...


LS (FKDATA,NFKS)		;SIGNL DATA WORD
LS (FKLIST,NFKS)		;SID,,Q-POINTER.	B0: DATA QUEUED
				;			B1: SID VALID


;TEMPORARY DEFINITIONS UNTIL PUT INTO ERRMES

SGNLX1==602001
SGNLX2==602002
SGNLX3==602003
SGNLX4==602004
SGNLX5==602005
SGNLX6==602006
SGNLX7==602007
SGNLX8==602010
SGNLX9==602011


	USE SWAPPC

;GET SIGNAL ID

;1/	FLAGS,,COUNT		;B0: MAKE ACCESSIBLE TO JOBS IN 2,3,...
				;B4: REQUIRE SYSTEM SIGNAL
;				;B3: MAKE ACCESSIBLE TO ALL JOBS
;2,3/	9-BIT BYTES: 777 OR JOB # IN EACH
;
;	GTSIG
;
;R+1:	 ERROR, NUMBER IN 1
;R+2:	OK, SID IN 1


.GTSIG::JSYS MENTR		;ENTER MONITOR
	NOINT
	TLNN 1,(1B0)		;MAKE ACCESSIBLE TO OTHER JOBS?
	SETOB 2,3		;NO. USE NULL JOB NUM