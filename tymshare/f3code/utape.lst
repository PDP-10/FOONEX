UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 1
UTAPE	MAC	15-Nov-69 02:37		EVS 9-MAR-81

     1					TITLE UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.
     2					SUBTTL EVS 9-MAR-81
     3
     4					;ACS
     5			000000		F=0
     6			400000			FL.MTI==(1B0)
     7			200000			FL.MTO==(1B1)
     8			000001		T1=1
     9			000002		T2=2
    10			000003		T3=3
    11			000004		T4=4
    12
    13			000005		P1=5
    14			000006		P2=6
    15			000007		P3=7
    16			000010		P4=10
    17			000017		P=17
    18
    19			000036		PDLLEN==^D30
    20
    21					;MACRO DEFINITIONS
    22
    23					DEFINE MSG(MESS)<OUTSTR	[ASCIZ\'MESS
    24					\]
    25					>
    26					DEFINE ERROR(MESS),<PUSHJ P, [MSG('MESS)
    27					
    28							EXIT 1,
    29							JRST .-1]>;END ERROR MACRO DEFINITION
    30
    31					;IO CHANNELS
    32			000001		ICHAN==1
    33			000002		OCHAN==2
    34
    35			000200		RECSIZ==200			;RECORD SIZE FOR MICROCODE TAPES.
    36
    37			000020		DV.MTA==(1B13)			;DEVICE IS TAPE
UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 2
UTAPE	MAC	15-Nov-69 02:37		EVS 9-MAR-81

    38					;INIT
    39
    40	000000'	255 00 0 00 000000 	ST:	JFCL
    41	000001'	047 00 0 00 000000 		RESET
    42	000002'	200 17 0 00 000224'		MOVE	P,[IOWD PDLLEN,PDL]
    43	000003'	400 00 0 00 000000 	RESTAR:	SETZ	F,
    44	000004'	550 01 0 00 000000*		HRRZ	T1,.JBFF##
    45	000005'	202 01 0 00 000223'		MOVEM	T1,BUFLOC
    46	000006'	270 01 0 00 000220'		ADD	T1,SIZREC
    47	000007'	047 01 0 00 000011 		CORE	T1,
    48						  ERROR	(UNEXPECTED CORE UUO ERROR)^PUSHJ P, [MSG(UNEXPECTED CORE UUO ERROR)^OUTSTR
    49						[ASCIZ\UNEXPECTED CORE UUO ERROR
    50					\]
    51							EXIT 1,
    52	000010'	260 17 0 00 000233'			JRST .-1]^
    53	000011'	200 01 0 00 000223'		MOVE	T1,BUFLOC
    54	000012'	504 01 0 00 000001 		HRL	T1,T1
    55	000013'	271 01 0 00 000001 		ADDI	T1,1
    56	000014'	200 02 0 00 000220'		MOVE	T2,SIZREC
    57	000015'	271 02 0 01 777776 		ADDI	T2,-2(T1)
    58	000016'	251 01 0 02 000000 		BLT	T1,(T2)
    59	000017'	200 02 0 00 000220'		MOVE	T2,SIZREC
    60	000020'	525 02 0 02 777777 		HRLOI	T2,-1(T2)
    61	000021'	444 02 0 00 000223'		EQV	T2,BUFLOC
    62	000022'	275 02 0 00 000001 		SUBI	T2,1
    63	000023'	202 02 0 00 000221'		MOVEM	T2,IOW
    64	000024'	402 00 0 00 000222'		SETZM	IOW+1
    65
    66					;PROMPT USER FOR COMMAND STRING.
    67
    68U	000025'	000000	000052*		GETCMD:	OUTCHI	"*"
    69	000026'	200 01 0 00 000236'		MOVE	T1,[DFOBLK,,FLOBLK]
    70U	000027'	260 17 0 00 000000*		PUSHJ	P,SCAN
    71	000030'	254 00 0 00 000121'		  JRST	CMDERR		;COMMAND ERROR
    72	000031'	306 02 0 00 000012 		CAIN	T2,12		;DONE ALREADY?
    73	000032'	254 00 0 00 000025'		JRST	GETCMD		;YES, NOOP.
    74	000033'	302 02 0 00 000075 		CAIE	T2,"="
    75	000034'	254 00 0 00 000121'		JRST	CMDERR
    76	000035'	200 01 0 00 000237'		MOVE	T1,[DFIBLK,,FLIBLK]
    77U	000036'	260 17 0 00 000027*		PUSHJ	P,SCAN
    78	000037'	254 00 0 00 000121'		  JRST	CMDERR
    79	000040'	302 02 0 00 000012 		CAIE	T2,12
    80	000041'	254 00 0 00 000121'		JRST	CMDERR		;NO GOOD.
    81
    82					;NOW OPEN UP DEVICES, SEE WHAT THEY ARE.
    83
    84	000042'	201 01 0 00 000017 		MOVEI	T1,17
    85U	000043'	200 02 0 00 000000#		MOVE	T2,FLOBLK+DEV
    86	000044'	400 03 0 00 000000 		SETZ	T3,
    87	000045'	050 02 0 00 000001 		OPEN	OCHAN,T1
    88						  ERROR	(OUTPUT DEVICE NOT AVAILABLE)^PUSHJ P, [MSG(OUTPUT DEVICE NOT AVAILABLE)^OU
    89					TSTR	[ASCIZ\OUTPUT DEVICE NOT AVAILABLE
    90					\]
    91							EXIT 1,
    92	000046'	260 17 0 00 000246'			JRST .-1]^
UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 2-1
UTAPE	MAC	15-Nov-69 02:37		EVS 9-MAR-81

    93	000047'	201 01 0 00 000002 		MOVEI	T1,OCHAN
    94	000050'	047 01 0 00 000004 		DEVCHR	T1,
    95	000051'	603 01 0 00 000020 		TLNE	T1,DV.MTA
    96	000052'	661 00 0 00 200000 		TLO	F,FL.MTO	;OUTPUT DEVICE IS TAPE
    97
    98	000053'	201 01 0 00 000017 		MOVEI	T1,17
    99U	000054'	200 02 0 00 000000#		MOVE	T2,FLIBLK+DEV
   100	000055'	400 03 0 00 000000 		SETZ	T3,
   101	000056'	050 01 0 00 000001 		OPEN	ICHAN,T1
   102						  ERROR	(INPUT DEVICE NOT AVAILABLE)^PUSHJ P, [MSG(INPUT DEVICE NOT AVAILABLE)^OUTS
   103					TR	[ASCIZ\INPUT DEVICE NOT AVAILABLE
   104					\]
   105							EXIT 1,
   106	000057'	260 17 0 00 000257'			JRST .-1]^
   107	000060'	201 01 0 00 000001 		MOVEI	T1,ICHAN
   108	000061'	047 01 0 00 000004 		DEVCHR	T1,
   109	000062'	603 01 0 00 000020 		TLNE	T1,DV.MTA
   110	000063'	661 00 0 00 400000 		TLO	F,FL.MTI	;INPUT DEVICE IS MTA.
   111
UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 3
UTAPE	MAC	15-Nov-69 02:37		EVS 9-MAR-81

   112					;SETUP FOR THE TRANSFER.
   113U	000064'	336 00 0 00 000000#		SKIPN	FLIBLK+USR
   114U	000065'	402 00 0 00 000000#		SETZM	FLIBLK+FPPN
   115U	000066'	336 00 0 00 000000#		SKIPN	FLOBLK+USR
   116U	000067'	402 00 0 00 000000#		SETZM	FLOBLK+FPPN
   117U	000070'	076 01 0 00 000000#		LOOKUP	ICHAN,FLIBLK+FCNT
   118						  ERROR	<INPUT FILE NOT FOUND>^PUSHJ P, [MSG(INPUT FILE NOT FOUND)^OUTSTR	[ASC
   119					IZ\INPUT FILE NOT FOUND
   120					\]
   121							EXIT 1,
   122	000071'	260 17 0 00 000267'			JRST .-1]^
   123U	000072'	077 02 0 00 000000#		ENTER	OCHAN,FLOBLK+FCNT
   124						  ERROR	<ENTER ERROR ON OUTPUT FILE>^PUSHJ P, [MSG(ENTER ERROR ON OUTPUT FILE)^OUTS
   125					TR	[ASCIZ\ENTER ERROR ON OUTPUT FILE
   126					\]
   127							EXIT 1,
   128	000073'	260 17 0 00 000300'			JRST .-1]^
   129	000074'	607 00 0 00 400000 		TLNN	F,FL.MTI
   130	000075'	254 00 0 00 000100'		JRST	SETUP1
   131	000076'	072 01 0 00 000001 		MTAPE	ICHAN,1		;REWIND INPUT TAPE
   132	000077'	072 01 0 00 000101 		MTAPE	ICHAN,101	;AND PUT INTO IBM MODE
   133	000100'	607 00 0 00 200000 	SETUP1:	TLNN	F,FL.MTO
   134	000101'	254 00 0 00 000104'		JRST	SETUP2
   135	000102'	072 02 0 00 000001 		MTAPE	OCHAN,1
   136	000103'	072 02 0 00 000101 		MTAPE	OCHAN,101
   137	000104'				SETUP2:
   138
   139	000104'	056 01 0 00 000221'	COPLUP:	IN	ICHAN,IOW
   140	000105'	254 00 0 00 000111'		  JRST	COPLU1
   141	000106'	063 01 0 00 740000 		STATZ	ICHAN,740000
   142						ERROR	<IO ERROR ON INPUT DEVICE.>^PUSHJ P, [MSG(IO ERROR ON INPUT DEVICE.)^OUTSTR
   143						[ASCIZ\IO ERROR ON INPUT DEVICE.
   144					\]
   145							EXIT 1,
   146	000107'	260 17 0 00 000311'			JRST .-1]^
   147	000110'	254 00 0 00 000116'		JRST	COPDON
   148	000111'	057 02 0 00 000221'	COPLU1:	OUT	OCHAN,IOW
   149	000112'	254 00 0 00 000104'		JRST	COPLUP
   150	000113'	063 02 0 00 740000 		STATZ	OCHAN,740000
   151						ERROR	<IO ERROR ON OUTPUT DEVICE>^PUSHJ P, [MSG(IO ERROR ON OUTPUT DEVICE)^OUTSTR
   152						[ASCIZ\IO ERROR ON OUTPUT DEVICE
   153					\]
   154							EXIT 1,
   155	000114'	260 17 0 00 000322'			JRST .-1]^
   156						ERROR	<UNEXPLAINED OUTPUT DEVICE ERROR>^PUSHJ P, [MSG(UNEXPLAINED OUTPUT DEVICE E
   157					RROR)^OUTSTR	[ASCIZ\UNEXPLAINED OUTPUT DEVICE ERROR
   158					\]
   159							EXIT 1,
   160	000115'	260 17 0 00 000334'			JRST .-1]^
   161
   162	000116'	071 01 0 00 000000 	COPDON:	RELEAS	ICHAN,
   163	000117'	071 02 0 00 000000 		RELEAS	OCHAN,
   164	000120'	254 00 0 00 000003'		JRST	RESTAR
   165
   166					CMDERR:	MSG	<COMMAND ERROR>^OUTSTR	[ASCIZ\COMMAND ERROR
UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 3-1
UTAPE	MAC	15-Nov-69 02:37		EVS 9-MAR-81

   167	000121'	051 03 0 00 000337'	\]
   168	000122'	306 02 0 00 000012 	CMDER1:	CAIN	T2,12		;TERMINATED BY LF?
   169	000123'	254 00 0 00 000025'		JRST	GETCMD		;YES, GET NEXT COMMAND
   170U	000124'	260 17 0 00 000000*		PUSHJ	P,GETCHR
   171	000125'	254 00 0 00 000122'		JRST	CMDER1
UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 4
UTAPE	MAC	15-Nov-69 02:37		EVS 9-MAR-81

   172	000126'	44 63 53 00 00 00 	DFIBLK:	SIXBIT/DSK/
   173	000127'	000000	000000			EXP 0,0		;USERNAME
   174	000130'	000000	000000
   175	000131'	000000	000003			3		;COUNT
   176	000132'	000000	000000			0		;PPN (FILLED IN BY SCAN)
   177	000133'	65 43 57 44 45 00 		SIXBIT/UCODE/	;FILENAME
   178	000134'	42 51 56 00 00 00 		SIXBIT/BIN/	;EXTENSION
   179	000135'				FLIBLK:	BLOCK	7	;PLACE FOR INPUT
   180	000144'	44 63 53 00 00 00 	DFOBLK:	SIXBIT/DSK/	;DEFAULT OUTPUT IS TAPE
   181	000145'	000000	000000			EXP	0,0	;USRNAM
   182	000146'	000000	000000
   183	000147'	000000	000003			3		;COUNT
   184	000150'	000000	000000			0		;PPN WORD (FILLED IN BY SCAN)
   185	000151'	65 43 64 41 60 45 		SIXBIT/UCTAPE/
   186	000152'	42 51 56 00 00 00 		SIXBIT/BIN/
   187
   188	000153'				FLOBLK:	BLOCK	7
   189
   190	000162'				PDL:	BLOCK	PDLLEN
   191	000220'	000000	000200		SIZREC:	RECSIZ			;DEFAULT RECORD SIZE, PATCHABLE
   192	000221'				IOW:	BLOCK	2
   193	000223'				BUFLOC:	BLOCK	1
   194
   195			000000'			END	ST
DEV	UNASSIGNED,NED AS IF EXTERNAL
FCNT	UNASSIGNED, DEFINED AS IF EXTERNAL
FPPN	UNASSIGNED, DEFINED AS IF EXTERNAL
GETCHR	UNASSIGNED, DEFINED AS IF EXTERNAL
OUTCHI	UNASSIGNED, DEFINED AS IF EXTERNAL
SCAN	UNASSIGNED, DEFINED AS IF EXTERNAL
USR	UNASSIGNED, DEFINED AS IF EXTERNAL

?12 ERRORS DETECTED

PROGRAM BREAK IS 000343
CPU TIME USED 00:19.570

10P CORE USED
UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page S-1
UTAPE	MAC	15-Nov-69 02:37		SYMBOL TABLE

BUFLOC		000223'		
CMDER1		000122'		
CMDERR		000121'		
COPDON		000116'		
COPLU1		000111'		
COPLUP		000104'		
CORE	047000	000011		
DEV		000000	udf	
DEVCHR	047000	000004		
DFIBLK		000126'		
DFOBLK		000144'		
DV.MTA		000020	spd	
EXIT	047000	000012		
F		000000		
FCNT		000000	udf	
FL.MTI		400000	spd	
FL.MTO		200000	spd	
FLIBLK		000135'		
FLOBLK		000153'		
FPPN		000000	udf	
GETCHR		000124'	udf	
GETCMD		000025'		
ICHAN		000001	spd	
IOW		000221'		
OCHAN		000002	spd	
OUTCHI		000000	udf	
OUTSTR	051140	000000		
P		000017		
P1		000005		
P2		000006		
P3		000007		
P4		000010		
PDL		000162'		
PDLLEN		000036	spd	
RECSIZ		000200	spd	
RESET	047000	000000		
RESTAR		000003'		
SCAN		000036'	udf	
SETUP1		000100'		
SETUP2		000104'		
SIZREC		000220'		
ST		000000'		
T1		000001		
T2		000002		
T3		000003		
T4		000004		
USR		000000	udf	
.JBFF		000004'	ext	


UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 1
UTAPE	MAC
Symbol cross reference

BUFLOC	    45	    53	    61	   193#
CMDER1	   168#	   171
CMDERR	    71	    75	    78	    80	   166#
COPDON	   147	   162#
COPLU1	   140	   148#
COPLUP	   139#	   149
DEV	    85	    99
DFIBLK	    76	   172#
DFOBLK	    69	   180#
DV.MTA	    37#	    95	   109
F	     5#	    43	    96	   110	   129	   133
FCNT	   117	   123
FL.MTI	     6#	   110	   129
FL.MTO	     7#	    96	   133
FLIBLK	    76	    99	   113	   114	   117	   179#
FLOBLK	    69	    85	   115	   116	   123	   188#
FPPN	   114	   116
GETCHR	   170
GETCMD	    68#	    73	   169
ICHAN	    32#	   101	   107	   117	   131	   132	   139	   141	   162
IOW	    63	    64	   139	   148	   192#
OCHAN	    33#	    87	    93	   123	   135	   136	   148	   150	   163
OUTCHI	    68
P	    17#	    42	    48	    70	    77	    88	   102	   118	   124	   142	   151	   156	   170
P1	    13#
P2	    14#
P3	    15#
P4	    16#
PDL	    42	   190#
PDLLEN	    19#	    42	   190
RECSIZ	    35#	   191
RESTAR	    43#	   164
SCAN	    70	    77
SETUP1	   130	   133#
SETUP2	   134	   137#
SIZREC	    46	    56	    59	   191#
ST	    40#	   195
T1	     8#	    44	    45	    46	    47	    53	    54	    55	    57	    58	    69	    76	    84	    87
	    93	    94	    95	    98	   101	   107	   108	   109
T2	     9#	    56	    57	    58	    59	    60	    61	    62	    63	    72	    74	    79	    85	    99
	   168
T3	    10#	    86	   100
T4	    11#
USR	   113	   115
.JBFF	    44
UTAPE - PROGRAM TO READ AND WRITE F3 MICROCODE TAPES.	MACRO %53B(1155)-2 13:14 10-Jul-87 Page 1
UTAPE	MAC
Macro/Opdef cross reference

CORE	    47
DEVCHR	    94	   108
ERROR	    26#	    48	    88	   102	   118	   124	   142	   151	   156
EXIT	    51	    91	   105	   121	   127	   145	   154	   159
MSG	    23#	    48	    88	   102	   118	   124	   142	   151	   156	   166
OUTSTR	    49	    89	   103	   118	   125	   143	   152	   157	   166
RESET	    41
%....U	    68	    70	    77	    85	    99	   113	   114	   115	   116	   117	   123	   170 < :”